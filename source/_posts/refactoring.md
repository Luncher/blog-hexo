---
title: 重读refactoring
date: 2018-05-09 21:08:41
tags: 重构
keywords: 
  - 重构
  - refactoring
categories: 软件开发
---

记得刚毕业那年，在网络上寻找各种经典的计算机软件工程相关书籍来阅读，其中就包含了`martin fowler`的`refactoring`这本书。毫无项目经验的我，对书中列举的各种重构方案如: `extract method`、`pull up method`等不以为然，一方面觉得这些点都太小了，简单的移动字段，提取函数真的有那么大的效用么？这当时在我心里是一个大大的问号。另一方面在我心里一直对重构有一种偏见，总觉得它是一种对软件架构设计缺陷的补丁方案，为什么当初在设计之初没有考虑好呢？这种打补丁的方案真的好吗？

最近重新阅读了这本书，五年来经历了大大小小多个项目，深刻体会到重构带来的价值。重构这种中庸之道，在不推翻所有代码的前提下，能够保证项目的正常交付，同时防止的代码的腐烂，这或许是最佳的工程实践方案了。

## 一、为什么需要重构

### 1、需求变更

软件开发领域切实的印证了那句话，`不变的或许就是变化本身`。程序员再项目开发的时候应该尽可能的洞悉项目未来的业务发展方向。但是，这也仅仅是一种可能。企业为了生存，需要不断的调整方向，来追求利益的最大化。需求变更或许是软件需要重构的最大原因。


### 2、人无完人

人无完人，我们不可能在项目开发初期就把架构设计的天衣无缝。或许某一天学习到了某个好的模式，希望把它运用到项目中，这个时候我们就需要重构了。也许因为项目开发周期短，一些模块不得不采用当下最快的方式来实现，等到未来某一天希望把实现方式通过重构变更一下。

## 二、准备工作

`重构`书本上列举了一系列需要重构的预判条件，这些统一称之为“坏味道”。其中包含，如："函数过长"、“函数参数过长”、"注释过多"、"类职责不单一"等等。再遇到这些情况的适合，我们就需要仔细的审视是不是该重构了。

嗅出这些坏味道只是第一步，正如`重构`的序言四人帮之一`Erich Gamma`说的那样：`设计模式`是实现重构的手段，所以在执行重构之前需要对常用的软件开发模式方法有一定的了解。

`重构`的定义：**在不改变软件外在行为的前提下，改善软件内部结构。**`重构`书中着重说明了测试的重要性，测试直接关系到重构的成败。没有测试作为保障的前提下进行重构那将会是一场灾难。对于动态语言更是如此，没有编译期的保障下，任何一点修正都无法及时发现。

## 三、常用原则

有了一定项目经验再回过头来看书中列举的各种重构案例，惊讶的发现，这不就是我一直在用的手段吗？原来我一直窃喜的开发方法早就有人总结并且广为流传了。其中最印象深刻的莫过于`Form Template Method`以及`Replace Conditional with Polymorphism`。`Form Template Method`需要对设计模式中的模版方法有一定的理解，反过来说，如果理解了模版方法会更加容易的发现它的适用场景。对于`Replace Conditional with Polymorphism`方案，不同的条件判断意味着不同的类别，在面向对象的大环境下很容易想到每个类别代替不同的子类。而不同的子类有不同的行为这刚好印证了面向对象编程最重要的特性：多态。

## 四、总结

软件开发更像是一门艺术，软件产品就是一个艺术品，需要不断的细心雕琢。非常赞同人月神话作者的那句话: "软件开发最大的复杂度来自于变化。"所以隔离变化，降低复杂度将会是软件开发永恒的主题。