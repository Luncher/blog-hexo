---
title: 译-视觉格式化模型的细节
date: 2016-09-05 13:21:15
tags: visual formatting model
categories: web
---

# 123

## 包含块的定义

元素位置以及尺寸的计算有时候涉及到一个固定的矩形，这个矩形称之为元素的`包含块`。元素的包含块定义如下：

<!-- more -->

- 1、`根元素`所在的包含块是一个矩形，称之为：初始包含块。对于连续介质或页面媒体，有包含尺寸大小的视口，锚定在画布的初始位置。初始包含块的方向属性等同于根元素。

- 2、对于其他元素，如果元素的`position`属性是`relative`或`static`,那么它的包含块被放置在最近的块容器祖先盒子的内容区边缘。

- 3、如果元素的`position`属性设置为`fixed`，那么它的包含块依据在连续介质的情况下或在页面媒体的情况下的页区域的视口来建立。

- 4、如果元素的`position`属性设置为`absolute`，那么它的包含块依据最近的，且`positon`属性被设置为`absolute`、`relative`、`fixed`,的祖先来建立。步骤如下：

  - 1、如果祖先是一个行内元素，那么它的包含块是一个边界盒子包围第一个以及最后一个元素的内边距。在`CSS2.1`,如果行内元素跨多行，那么其包含块是未定义的。
  - 2、否则，包含块根据其祖先的`padding edge`来格式化。
  - 3、如果没有找到这样的祖先元素，那么其包含块就是最初的包含块。

在页面媒体下，一个绝对定位元素的位置关联到它的包含块，忽略任何的分页(好像页面是连续的)，元素可能被分到多个页面。

对于绝对定位的内容，被解析到页面的某个位置，而不是页面被布局的位置，或者解析到当前已经被渲染或者打印的页面，打印机或许会放置内容。

- 当前页面的其他位置
- 在随后的页面，或者
- 省略它

>注意：一个块级元素超过了多个页或许会在不同的页有不同的宽度，或许会设备自身的限制。



```html
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN">
<HTML>
   <HEAD>
      <TITLE>Illustration of containing blocks</TITLE>
   </HEAD>
   <BODY id="body">
      <DIV id="div1">
      <P id="p1">This is text in the first paragraph...</P>
      <P id="p2">This is text <EM id="em1"> in the 
      <STRONG id="strong1">second</STRONG> paragraph.</EM></P>
      </DIV>
   </BODY>
</HTML>
```

没有定位，上面文档将建立如下的包含块：

| For box generated by | C.B is established by      |
| -------------------- |:---------------------------|
| html                 |  initial C.B(UA-dependent) |
| body                 | html                       |
| div1                 | body                       |
| p1                   | div1                       |
| p2                   | div1                       |
| em1                  | p2                         |
| strong1              | p2                         |

如果我们修改`div1`的`position`属性：

```css
  #div {positon: absolute; left: 50px; top: 50px}
```

那么它的包含块将不再是`body`,而是变成了最初的包含块(因为没有被定位的祖先盒子)。

如果我们把`em1`的`position`属性也修改了：

```css
  #div {position: absolute; left: 50px; top: 50px}
  #em1 {position: absolute; left: 100px; top: 100px}
```

包含块表格现在变成了：

| For box generated by | C.B is established by      |
| -------------------- |:---------------------------|
| html                 | initial C.B(UA-dependent)  |
| body                 | html                       |
| div1                 | initial C.B                |
| p1                   | div1                       |
| p2                   | div1                       |
| em1                  | div1                       |
| strong1              | em1                        |

通过修改`em1`的`positon`属性，它的包含块变成了最近的已经定位的祖先盒子(这里是`div1`生成的盒子)。

---

## 内容区的宽度：`width`属性

`width`
  可选值:  \<<u>length</u>\>|\<<u>percentage</u>\>|auto|inherit  
  初始值: auto  
  适用对像: 所有除了行内非替换元素的对象,包括表格行、和表格行组。
  百分比: 根据包含块的宽度计算  
  媒体: 视觉的  
  计算值: 百分比或者`auto`或者绝对长度

该属性指定了盒子的内容区域宽度。

这个属性不适用于行内非替换元素。行内非替换元素的盒子宽度将由其绘制的内容决定。顺便说一下，行内盒子依照多个盒子的行线摆放。在同一行的多个盒子的宽度通过包含块指定，但是也可以通过浮动来设置。

属性值有如下含义：

- <u>length</u>  
  指定内容区域长度，使用一个长度单位。

- <u>percentage</u>  
  指定一个百分比宽度，百分比依照生成元素盒子的包含块的宽度计算。如果包含块宽度依赖于元素宽度，那么布局是未定以的。

- auto 
  宽度依赖于其他属性，下面会讨论。

给`width`属性设置负数是非法的。

---

## 计算宽度以及外边距

元素的`width`、`margin-right`、`margin-left`和`left`、`right`属性用于布局，取决于生成盒子的类型。(属性值用于布局，有时被称之为被使用的值。)原则上，属性值和计算值类似，通过`auto`替换为恰当的值，百分比基于包含块来计算，但是它们是特殊的。以下情况需要被区分开来：

- 1、行内非替换元素

- 2、行内替换元素

- 3、在正常流中的块级非替换元素

- 4、在正常流中的块级替换元素

- 5、浮动非替换元素

- 6、浮动替换元素

- 7、绝对定位，非替换元素

- 8、绝对定位，替换元素

- 9、在正常流中的`inlin-block`,非替换元素

- 10、在正常流中的`inline-block`,替换元素

对于`1-6`和`9-10`,`left`和`right`属性值，如果是相对请为的情况下，由[section 9.4.3.](https://www.w3.org/TR/CSS2/visuren.html#relative-positioning),定义。

---

### 行内非替换元素

`width`属性不起作用，如果给`margin-left`、`margin-right`设置为`auto`,将会计算为`0`.

### 行内替换元素

如果给`margin-left`、`margin-right`设置为`auto`,将会计算为`0`.
如果`height`和`width`属性都设置为`auto`,并且元素有固有宽度，那么固有宽度作为`width`属性的值。

如果`height`和`width`设置为`auto`,并且元素没有固有宽度，但是元素有固有高度以及固有比率；或者如果`width`属性值设置为`auto`,`height`有其他计算值，并且元素有固有比率，那么元素宽度计算为：

>(used height) * (intrinsic ratio)

如果`height`和`width`属性都设置为`auto`,并且元素有固有比率，但是没有固有的宽度或者高度，`CSS2.1`定义该情况下`width`的值未定义。但是其建议如下：
如果包含块宽度本身并不依赖于替换元素的宽度，那么`width`的值的计算和正常流中的块级非替换元素类似。

否则，如果`width`的值设置为`auto`,元素有固有宽度，那么固有宽度作为元素宽度。

否则，如果`width`的值设置为`auto`,但是以下情况都不满足，`width`属性值为`300px`,如果`300px`对于设备来说太宽，用户代理将使用最大矩形的宽度：比率为`2:1`，适配设备。

### 正常流中的块级非替换元素

下面的约束必须配置其他属性进行：
>'margin-left' + 'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' + 'margin-right' = width of containing block

如果`width`不是`auto`,并且'border-left-width' + 'padding-left' + 'width' + 'padding-right' + 'border-right-width' (加上 不为`auto`的 'margin-left' 或者 'margin-right' 的值)。大于包含块的宽度，那么任何属性值设置为`auto`的`margin-left`或者`margin-right`, 遵循以下规则，设置为`0`.

如果以上属性有一个计算值，而不是`auto`,这被称之为超过限制，那么其中一个属性值必须调整不同于其计算值。如果包含块的方向从左到右，那么指定给`margin-right`的特定值会被忽略，重置一个值，以适配等式成立。反之，如果包含块的方向从右到左，同理。

如果有一个值被指定为`auto`,其值根据等式计算。

如果`width`设置为`auto`,任何其他设置为`auto`的属性值变为`auto`,并且`width`属性值根据等式计算。

如果`margin-left`和`margin-right`设置为`auto`,那么它们实际的值是相等的，用于把元素相对于包含块水平居中。

### 正常流中的块级替换元素

`width`属性的实际值类似于：`行内替换元素`.而外边距的值依据:`非替换块级元素决定`。

### 浮动，非替换元素

如果`margin-left`或者`margin-right`设置为`auto`,那么世纪值计算为`0`.
如果`width`设置为`auto`,那么实际值将收缩适应元素.

计算收缩适应的宽度类似于计算`table cell`的宽度，使用自动表布局算法。粗略的说：通过格式化内容区不换行，除非遇到换行符，得到一个优选宽度，并且计算一个恰当的最小宽度，例如：尝试任何可能的换行.`CSS2.1`没有定义具体的算法.第三，找到可用的宽度：在这种情况下，宽度为包含块减去另外六个盒模型属性以及可能的滚动条的宽度。

自适应宽度取: min(max(最小宽度，可用宽度)，自适应宽度).

### 浮动，替换元素

如果`margin-left`或者`margin-right`设置为`auto`,实际值为`0`.`width`属性的实际值参照`行内替换元素`。

### 绝对定位，非替换元素

这个章节和下面一个章节的目的，术语`静态位置`参考，粗略的说，一个元素的位置必须在正常流中.清晰的定义：

- 静态位置的包含块是一个假想的盒子，如果`position`属性设置为`static`，并且`float`属性设置为`none`,那么将作为元素的第一个盒子。(由于[section 9.7](https://www.w3.org/TR/CSS2/visuren.html#dis-pos-flo)的限制，这个假想计算或许需要给`display`属性指定一个特殊值.)
- 如果`position`属性设置为`static`，并且`float`属性设置为`none`, 静态位置的`left`属性计算从包含块的左边缘到假想外边距的左边,这将作为元素的第一个盒子。其值将是负数，如果假想盒位于包含块的左边。
- 静态位置的`right`属性计算从包含块的右边缘到假想盒的右边缘，同上。如果假想盒子位于包含块的左边，其值将会是正数。

但不是实际的计算假想盒子的尺寸，用户代理会自由猜测其可能的位置。

