---
title: 分布式ID生成
date: 2018-9-26 14:10:35
tags: database
categories: 数据库
---

在分布式系统的大环境下，传统的自增方式生成唯一ID已经不太适用了，因为等到业务规模大到一定的体量的时候，必须要考虑到分库分表的问题，就不能保证ID的唯一性。所以我们需要一个替代方案来生成唯一ID。

<!-- more -->


现有的几种全局ID生成方式：

+ 通过redis自增数值
+ Twitter`snowflake`算法
+ 美团点评`Leaf`分布式ID生成系统
  

### 利用redis生成唯一ID

redis是一个单进程单线程的架构（不考虑到快照备份、数据同步等）。其有一个`incr`原子指令，用于对数值加1操作。并返回执行 INCR 命令之后 key 的值。

+ 优点，自增ID天然有序，对于数据库索引写入性能较好。
+ 缺点，引入redis相当于引入了一个单点的性能瓶颈，同时增加了系统的复杂度和维护成本。


### Twitter`snowflake`算法

![snowflake](/images/snowflake)

`snowflake`生成一个64位的数值，前41bit是一个时间戳，精确到毫秒，中间10个bit用于表示机器组，一个集群最多可以表示1024台机器，后12bit表示随机数。2^12=4096，即：每台机器每毫秒最多可以生成4096个ID。

+ 优点，实现简单，不依赖于第三方组件。
+ 缺点，在并发量大的情况下会出现ID冲突的情况。


### 美团点评`Leaf`分布式ID生成系统

Leaf 是美团开源的分布式ID生成器，能保证全局唯一性、趋势递增、单调递增、信息安全，里面也提到了几种分布式方案的对比，但也需要依赖关系数据库、Zookeeper等中间件。

具体可以参考官网说明: [Leaf 分布式ID](https://tech.meituan.com/MT_Leaf.html)


