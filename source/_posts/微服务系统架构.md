---
title: 微服务系统架构
categories: server
date: 2017-10-07 13:10:30
---

## 一、引入微服务架构需要作出权衡

微服务解决了传统`SOA`项目开发部署的效率问题，大大提升了产品的迭代速度。另一方面通过把需求合理的划分为单一小模块，针对不同业务场景可以采用不同的技术选型。

微服务的优势已经被研究的很透彻，但是在实践的过程中需要作出权衡。在业务规模比较小的时候传统的单一代码库的开发效率远高于微服务。也就是说在项目初期，产品方向不明确，这个时候采用传统的单一代码库来开发是一个更好的选择。随着业务复杂度的上升，微服务模式的开发效率逐渐高于单体代码仓库。

<!-- more -->

![cat](/images/micro-vs-soa.jpeg)

可以看到在项目前期`SOA`开发效率比较高，随着项目不断迭代，需求复杂度上升，到达某一零界点的时候微服务架构开发效率高于`SOA`模式这个时候微服务的优势才慢慢体现出来。

## 二、微服务架构与组织模块划分

著名的[康威法则](https://en.wikipedia.org/wiki/Conway%27s_law)为团队的组织关系与系统代码架构的划分给出了良好的建议：

>设计系统的组织，其产生的设计和架构等价于组织间的沟通结构。

团队之间是松散的，而单一应用必须让不同团队协同开发测试部署，成本比较高。通过把项目合理划分到不同的团队，互不干扰，系统效率得到了提升。


## 三、微服务总体技术架构

![microServices-Layers](/images/微服务系统架构分层模型.png)


## 四、微服务网关

网关作为微服务入口主要有以下几个功能：

1. 反向路由
2. 认证安全
3. 限流熔断
4. 日志监控

常见的网关如`zuul`, 和基于`openResty`的`Kong`都有很好的支持。


## 五、微服务集中配置中心

随着微服务数量增多集中化配置会慢慢变成一个痛点，集中化配置主要有以下一些优点：

+ 可追溯
+ 响应快
+ 集中化管理

常用的集中化配置实现方式：

1. pull模式(定时拉取)
2. push模式(配置更新推送)

作为业界微服务的楷模`Netflix`开源了一个[archaius](https://github.com/Netflix/archaius)专门负责配置管理。


## 六、微服务通信方式RPC vs REST

|       | RPC                          | REST            |
| ----- | ---------------------------- | --------------- |
| 耦合性   | 强耦合                          | 松散耦合            |
| 消息协议  | 二进制、thrift、protobuf          | 文本XML、JSON      |
| 通信协议  | TCP                          | HTTP／HTTP2      |
| 性能    | 高                            | 一般低于RPC         |
| 接口契约  | thrift、protobuf              | swagger、openAPI |
| 客户端   | 强类型客户端、一般通过工具自动生成            | 普通http请求客户端即可   |
| 案例    | Dubbo、motan、Tars、grpc、thrift | Jax-rs          |
| 开发者友好 | 客户端集成方便、二进制消息不可读             | 文本消息可读          |
| 对外开放  | 一般需要转换成REST/文本协议             | 直接可以对外开放        |
